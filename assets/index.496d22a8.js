import{_ as e,o as t,d as i,x as n,y as o,a as r,g as a,z as s,B as l,C as u,D as c,j as d,U as p,h as f,E as v,p as m,F as g,G as h,H as y,f as x,I as w,s as F,i as b,e as j,t as O,c as C,J as k,K as A,L,M as R,n as S,N as M,P as G,O as I}from"./workspace.2a4785ba.js";import{a as D}from"./Content.b7a0990b.js";import{d as E,E as P,w as W,i as B,l as N}from"./vendor.1bd2b8e6.js";import{I as V}from"./Input.408dcd39.js";import{C as z}from"./Card.94855f1a.js";import"./oauth.a592370f.js";import"./debounce.67102cb7.js";import"./index.98b229ad.js";import"./createChainedFunction.2d5d7d53.js";import"./ExclamationCircleFilled.27963c8d.js";import"./CloseCircleFilled.95e08edd.js";import"./LoadingOutlined.9700002e.js";import"./CloseCircleOutlined.6d9c7e17.js";import"./InfoCircleOutlined.84638a0f.js";import"./code.aa7872b2.js";import"./index.5de5e16b.js";import"./antInputDirective.093c4552.js";import"./index.9563d230.js";import"./index.39d89e53.js";import"./tabs.bc9c9fda.js";import"./LeftOutlined.50f925a1.js";import"./Col.9fc09512.js";function H(e,t){return e.views.find((function(e){return e.id===t}))}function T(e){return"number"==typeof e&&!isNaN(e)}function U(s){var l=s.options,u=l.xField,c=l.yField,d=l.interval,p=l.seriesField,f=l.tooltip,v=l.minColumnWidth,m=l.maxColumnWidth,g=l.columnBackground,h=l.dodgePadding,y=l.intervalPadding,x=r(f,[u,c,p]),w=x.fields,F=x.formatter,b=(d?a(i({},s,{options:{type:"interval",colorField:p,tooltipFields:w,mapping:e({tooltip:F},d),args:{dodgePadding:h,intervalPadding:y,minColumnWidth:v,maxColumnWidth:m,background:g}}})):s).ext;return function(e){var r=e.chart,a=e.options,s=e.ext,l=a.seriesField,u=a.isGroup,c=a.isStack,d=a.marginRatio,p=a.widthRatio,f=a.groupField,v=a.theme,m=[];return l&&(u&&m.push({type:"dodge",dodgeBy:f||l,marginRatio:d}),c&&m.push({type:"stack",marginRatio:d})),m.length&&(null==s?void 0:s.geometry)&&(null==s?void 0:s.geometry).adjust(m),t(p)||r.theme(i({},n(v)?v:o(v),{columnWidthRatio:p})),e}(e(e({},s),{ext:b}))}var q,J,K,X;(J=q||(q={})).Left="Left",J.Right="Right",(X=K||(K={})).Line="line",X.Column="column";var $={nice:!0,label:{autoHide:!0,autoRotate:!1}},_=e(e({},$),{position:"left"}),Q=e(e({},$),{position:"right",grid:null});function Y(e){return u(e,"geometry")===K.Line}function Z(e){return u(e,"geometry")===K.Column}function ee(t,n,o){return Z(o)?i({},{geometry:K.Column,label:o.label&&o.isRange?{content:function(e){var t;return null===(t=e[n])||void 0===t?void 0:t.join("-")}}:void 0},o):e({geometry:K.Line},o)}function te(e,t){var i=e[0],n=e[1];return c(t)?[t[0],t[1]]:[u(t,i),u(t,n)]}function ie(e,t){return t===q.Left?!1!==e&&i({},_,e):t===q.Right?!1!==e&&i({},Q,e):e}function ne(e){var t=e.view,i=e.geometryOption,n=e.yField,o=e.legend,r=u(o,"marker"),a=d(t,Y(i)?"line":"interval");if(!i.seriesField){var s=a.getAttribute("color").values[0],c=r||(Y(i)?{symbol:function(e,t,i){return[["M",e-i,t],["L",e+i,t]]},style:{lineWidth:2,r:6,stroke:s}}:{symbol:"square",style:{fill:s}});return[{value:n,name:u(t,"options.scales."+n+".alias")||n,marker:c,isGeometry:!0,viewId:t.id}]}var f=a.getGroupAttributes();return l(f,(function(e,i){var n=p.getLegendItems(t,a,i,t.getTheme(),r);return e.concat(n)}),[])}var oe=function(e,t){var i=t[0],n=t[1],o=e.getOptions().data,r=e.getXScale(),a=h(o);if(r&&a){var s=y(o,r.field),l=h(s),u=Math.floor(i*(l-1)),c=Math.floor(n*(l-1));e.filter(r.field,(function(e){var t=s.indexOf(e);return!(t>-1)||function(e,t,i){var n=Math.min(t,i),o=Math.max(t,i);return e>=n&&e<=o}(t,u,c)})),e.render(!0)}};function re(e){var t,n=e.options,o=n.geometryOptions,r=void 0===o?[]:o,a=n.xField,s=n.yField,l=w(r,(function(e){var t=e.geometry;return t===K.Line||void 0===t}));return i({},{options:{geometryOptions:[],meta:(t={},t[a]={type:"cat",sync:!0,range:l?[0,1]:void 0},t),tooltip:{showMarkers:l,showCrosshairs:l,shared:!0,crosshairs:{type:"x"}},interactions:l?[{type:"legend-visible-filter"}]:[{type:"legend-visible-filter"},{type:"active-region"}],legend:{position:"top-left"}}},e,{options:{yAxis:te(s,n.yAxis),geometryOptions:[ee(0,s[0],r[0]),ee(0,s[1],r[1])],annotations:te(s,n.annotations)}})}function ae(t){var n=t.chart,o=t.options,r=o.xField,a=o.yField,u=o.geometryOptions,c=o.data,d=o.tooltip,p={line:0,column:1};return[e(e({},u[0]),{id:"left-axes-view",data:c[0],yField:a[0]}),e(e({},u[1]),{id:"right-axes-view",data:c[1],yField:a[1]})].sort((function(e,t){return-p[e.geometry]+p[t.geometry]})).forEach((function(t){var o=t.id,a=t.data,u=t.yField,c=Z(t)&&t.isPercent,p=c?function(t,i,n,o){var r=l(t,(function(e,t){var o=t[n],r=e.has(o)?e.get(o):0,a=t[i];return r=T(a)?r+a:r,e.set(o,r),e}),new Map);return s(t,(function(t){var a,s=t[i],l=t[n],u=T(s)?s/r.get(l):0;return e(e({},t),((a={})[o]=u,a))}))}(a,u,r,u):a,h=n.createView({id:o}).data(p),y=c?e({formatter:function(e){return{name:e[t.seriesField]||u,value:(100*Number(e[u])).toFixed(2)+"%"}}},d):d;!function(t){var n=t.options,o=t.chart,r=n.geometryOption,a=r.isStack,s=r.color,l=r.seriesField,u=r.groupField,c=r.isGroup,d=["xField","yField"];if(Y(r)){f(i({},t,{options:e(e(e({},v(n,d)),r),{line:{color:r.color,style:r.lineStyle}})})),m(i({},t,{options:e(e(e({},v(n,d)),r),{point:r.point&&e({color:s,shape:"circle"},r.point)})}));var p=[];c&&p.push({type:"dodge",dodgeBy:u||l,customOffset:0}),a&&p.push({type:"stack"}),p.length&&g(o.geometries,(function(e){e.adjust(p)}))}Z(r)&&U(i({},t,{options:e(e(e({},v(n,d)),r),{widthRatio:r.columnWidthRatio,interval:e(e({},v(r,["color"])),{style:r.columnStyle})})}))}({chart:h,options:{xField:r,yField:u,tooltip:y,geometryOption:t}})})),t}function se(e){var t,i=e.chart,n=e.options.geometryOptions,o=(null===(t=i.getTheme())||void 0===t?void 0:t.colors10)||[],r=0;return i.once("beforepaint",(function(){g(n,(function(e,t){var n=H(i,0===t?"left-axes-view":"right-axes-view");if(!e.color){var a=n.getGroupScales(),s=u(a,[0,"values","length"],1),l=o.slice(r,r+s).concat(0===t?[]:o);n.geometries.forEach((function(t){e.seriesField?t.color(e.seriesField,l):t.color(l[0])})),r+=s}})),i.render(!0)})),e}function le(e){var t,n,o=e.chart,r=e.options,a=r.xAxis,s=r.yAxis,l=r.xField,u=r.yField;return F(((t={})[l]=a,t[u[0]]=s[0],t))(i({},e,{chart:H(o,"left-axes-view")})),F(((n={})[l]=a,n[u[1]]=s[1],n))(i({},e,{chart:H(o,"right-axes-view")})),e}function ue(e){var t=e.chart,i=e.options,n=H(t,"left-axes-view"),o=H(t,"right-axes-view"),r=i.xField,a=i.yField,s=i.xAxis,l=i.yAxis;return t.axis(r,!1),t.axis(a[0],!1),t.axis(a[1],!1),n.axis(r,s),n.axis(a[0],ie(l[0],q.Left)),o.axis(r,!1),o.axis(a[1],ie(l[1],q.Right)),e}function ce(e){var t=e.chart,i=e.options.tooltip,n=H(t,"left-axes-view"),o=H(t,"right-axes-view");return t.tooltip(i),n.tooltip({shared:!0}),o.tooltip({shared:!0}),e}function de(e){var t=e.chart;return b(i({},e,{chart:H(t,"left-axes-view")})),b(i({},e,{chart:H(t,"right-axes-view")})),e}function pe(e){var t=e.chart,n=e.options.annotations,o=u(n,[0]),r=u(n,[1]);return j(o)(i({},e,{chart:H(t,"left-axes-view"),options:{annotations:o}})),j(r)(i({},e,{chart:H(t,"right-axes-view"),options:{annotations:r}})),e}function fe(e){var t=e.chart;return O(i({},e,{chart:H(t,"left-axes-view")})),O(i({},e,{chart:H(t,"right-axes-view")})),O(e),e}function ve(e){var t=e.chart;return C(i({},e,{chart:H(t,"left-axes-view")})),C(i({},e,{chart:H(t,"right-axes-view")})),e}function me(e){var t=e.chart,n=e.options.yAxis;return k(i({},e,{chart:H(t,"left-axes-view"),options:{yAxis:n[0]}})),k(i({},e,{chart:H(t,"right-axes-view"),options:{yAxis:n[1]}})),e}function ge(e){var t=e.chart,o=e.options,r=o.legend,a=o.geometryOptions,s=o.yField,l=o.data,c=H(t,"left-axes-view"),d=H(t,"right-axes-view");return!1===r?t.legend(!1):n(r)&&!0===r.custom?t.legend(r):(t.once("beforepaint",(function(){var e=l[0].length?ne({view:c,geometryOption:a[0],yField:s[0],legend:r}):[],n=l[1].length?ne({view:d,geometryOption:a[1],yField:s[1],legend:r}):[];t.legend(i({},r,{custom:!0,items:e.concat(n)}))})),t.on("legend-item:click",(function(e){var i=u(e,"gEvent.delegateObject",{});if(i&&i.item){var n=i.item,o=n.value,r=n.isGeometry,a=n.viewId;if(r){if(function(e,t,i){void 0===i&&(i=0);for(var n=i;n<e.length;n++)if(t(e[n],n))return n;return-1}(s,(function(e){return e===o}))>-1){var l=u(H(t,a),"geometries");g(l,(function(e){e.changeVisible(!i.item.unchecked)}))}}else{var c=u(t.getController("legend"),"option.items",[]);g(t.views,(function(e){var i=e.getGroupScales();g(i,(function(t){t.values&&t.values.indexOf(o)>-1&&e.filter(t.field,(function(e){return!A(c,(function(t){return t.value===e})).unchecked}))})),t.render(!0)}))}}}))),e}function he(e){var t=e.chart,i=e.options.slider,n=H(t,"left-axes-view"),o=H(t,"right-axes-view");return i&&(n.option("slider",i),n.on("slider:valuechanged",(function(e){var t=e.event,i=t.value,n=t.originValue;L(i,n)||oe(o,i)})),t.once("afterpaint",(function(){if(!R(i)){var e=i.start,t=i.end;(e||t)&&oe(o,[e,t])}}))),e}function ye(e){return x(re,ae,le,ue,me,ce,de,pe,fe,ve,se,ge,he)(e)}var xe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="dual-axes",t}return S(t,e),t.prototype.getDefaultOptions=function(){return i({},e.prototype.getDefaultOptions.call(this),{yAxis:[],syncViewPadding:!0})},t.prototype.getSchemaAdaptor=function(){return ye},t.prototype.setState=function(e,t,i){void 0===i&&(i=!0);var n=M(this.chart);g(n,(function(n){t(n.getData())&&n.setState(e,i)}))},t.prototype.getStates=function(){var e=M(this.chart),t=[];return g(e,(function(e){var i=e.getData(),n=e.getStates();g(n,(function(n){t.push({data:i,state:n,geometry:e.geometry,element:e})}))})),t},t}(G),we=E({props:{data:{type:Object,default:()=>({column:[],line:[]})}},setup(e){let t;const i={data:[e.data.column,e.data.line],xField:"date",yField:["value","count"],geometryOptions:[{geometry:"column",isStack:!0,seriesField:"type"},{geometry:"line",label:{style:{fill:"#626681"}}}]};return P((()=>{t=new xe("columnContainer",i),t.render()})),W(e.data,(e=>{t.changeData([e.column,e.line])})),()=>B("div",{id:"columnContainer"},null)}});var Fe=E({setup(){const e=N(!0),t=N({column:[],line:[]}),i=N(""),n=async()=>{const i=await I();t.value.column.splice(0,i.length,...i),t.value.line=(e=>{const t={};return e.forEach((e=>{t[e.date]>=0?t[e.date]=t[e.date]+e.value:t[e.date]=e.value})),Object.entries(t).map((([e,t])=>({date:e,count:t})))})(t.value.column),e.value=!1};return P((()=>{e.value=!1})),W(i,(e=>{"MzMz"===btoa(e)&&n()})),()=>B(D,null,{default:()=>{return[B(V,{value:i.value,"onUpdate:value":e=>i.value=e},null),B(z,{title:`总计营收：${n=[...t.value.column],n.reduce(((e,t)=>e+t.value),0)}`,style:{"margin-bottom":"24px"},loading:e.value,bordered:!1,"body-style":{padding:0}},{default:()=>[B("div",{style:"min-height: 400px;margin:12px 24px"},[B(we,{data:t.value},null)])]})];var n}})}});export default Fe;
